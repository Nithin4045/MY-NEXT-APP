name: Auto Backup to Local

on:
  push:
    branches: [main]
  schedule:
    - cron: '*/10 * * * *'  # Every 10 minutes
  workflow_dispatch:  # Manual trigger

jobs:
  create-backup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Build project
      run: npm run build
      
    - name: Create Ready-to-Run Backup
      run: |
        TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
        COMMIT_SHA=$(git rev-parse --short HEAD)
        
        # Create backup folder
        mkdir -p my-next-app-backup
        
        # Copy all project files
        cp -r . my-next-app-backup/
        
        # Remove unnecessary files
        rm -rf my-next-app-backup/.git
        rm -rf my-next-app-backup/node_modules
        
        # Create run script for Windows
        cat > my-next-app-backup/RUN_ME.bat << 'EOF'
@echo off
title MY-NEXT-APP - GitHub Backup
echo =================================
echo   MY-NEXT-APP - GITHUB BACKUP
echo =================================
echo Created from GitHub Actions
echo.
echo ðŸ“¦ Installing dependencies...
npm install
echo.
echo ðŸŒ Starting development server...
echo ðŸš€ Open: http://localhost:3000
echo.
npm run dev
pause
EOF

        # Create info file
        echo "GitHub Backup created: $(date)" > my-next-app-backup/BACKUP_INFO.txt
        echo "Commit: $COMMIT_SHA" >> my-next-app-backup/BACKUP_INFO.txt
        echo "Repository: $GITHUB_REPOSITORY" >> my-next-app-backup/BACKUP_INFO.txt
        echo "Workflow: $GITHUB_RUN_ID" >> my-next-app-backup/BACKUP_INFO.txt
        
        # Create zip file
        zip -r my-next-app-backup-$TIMESTAMP-$COMMIT_SHA.zip my-next-app-backup/
        
        echo "âœ… Backup created: my-next-app-backup-$TIMESTAMP-$COMMIT_SHA.zip"
        
    - name: Upload Backup
      uses: actions/upload-artifact@v4
      with:
        name: my-next-app-backup
        path: *.zip
        retention-days: 7
