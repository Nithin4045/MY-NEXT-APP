name: Auto Backup to Local

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  create-backup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Create Backup Package
      run: |
        echo "Creating backup package..."
        
        # Create backup folder
        mkdir -p my-next-app-backup
        
        # Copy files
        cp -r app my-next-app-backup/ || echo "app folder copied"
        cp -r public my-next-app-backup/ || echo "public folder copied"
        cp package.json my-next-app-backup/
        cp package-lock.json my-next-app-backup/ 2>/dev/null || echo "No package-lock.json"
        
        # Create simple batch file without special characters
        echo "echo Starting MY-NEXT-APP" > my-next-app-backup/RUN.bat
        echo "npm install" >> my-next-app-backup/RUN.bat
        echo "npm run dev" >> my-next-app-backup/RUN.bat
        echo "pause" >> my-next-app-backup/RUN.bat
        
        # Create info file
        echo "Backup created: $(date)" > my-next-app-backup/INFO.txt
        
        # Create zip
        zip -r my-next-app-backup.zip my-next-app-backup/
        echo "Backup created successfully!"
        
    - name: Upload Backup
      uses: actions/upload-artifact@v4
      with:
        name: my-next-app-backup
        path: my-next-app-backup.zip
